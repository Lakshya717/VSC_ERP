{% extends 'partials/blank.html' %}
{% load static %}

{% block title %}
    Profile - VSC ERP
{% endblock %}

{% block content %}
<h3 class="text-dark mb-4">Profile</h3>
<div class="row mb-3">
    <div class="col-lg-4">
        <div class="card mb-3">
            <div class="card-body text-center shadow"><img class="rounded-circle mt-4 mb-3" src="{% static 'assets/img/dogs/image2.jpeg' %}" width="160" height="160">
                <div class="mb-3"><button class="btn btn-primary btn-sm" type="button">Change Photo</button></div>
            </div>
        </div>
    </div>
    <div class="col-lg-8">
        <div class="row">
            <div class="col">
                <div class="card shadow mb-3">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">User Details</p>
                    </div>
                    <div class="card-body">
                        <form method="post" novalidate>
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="user_edit_form">

                            <!-- Non-field errors -->
                            {% if form.non_field_errors %}
                                <div class="alert alert-danger">
                                    {% for error in form.non_field_errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}

                            <div class="row">
                                <div class="col">
                                    <div class="mb-3">
                                        <label class="form-label" for="username"><strong>Username</strong></label>
                                        <input id="username" class="form-control {% if form.username.errors %}is-invalid{% endif %}" 
                                            type="text" name="username" value="{{ form.username.value|default:user.username }}" readonly>
                                        {% for error in form.username.errors %}
                                            <div class="invalid-feedback">{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label class="form-label" for="email"><strong>Email Address</strong></label>
                                        <input id="email" class="form-control {% if form.email.errors %}is-invalid{% endif %}" 
                                            type="email" name="email" value="{{ form.email.value|default:user.email }}">
                                        {% for error in form.email.errors %}
                                            <div class="invalid-feedback">{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <div class="mb-3">
                                        <label class="form-label" for="first_name"><strong>First Name</strong></label>
                                        <input id="first_name" class="form-control {% if form.first_name.errors %}is-invalid{% endif %}" 
                                            type="text" name="first_name" value="{{ form.first_name.value|default:user.first_name }}">
                                        {% for error in form.first_name.errors %}
                                            <div class="invalid-feedback">{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label class="form-label" for="last_name"><strong>Last Name</strong></label>
                                        <input id="last_name" class="form-control {% if form.last_name.errors %}is-invalid{% endif %}" 
                                            type="text" name="last_name" value="{{ form.last_name.value|default:user.last_name }}">
                                        {% for error in form.last_name.errors %}
                                            <div class="invalid-feedback">{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <button class="btn btn-primary btn-sm" type="submit">Save Settings</button>
                            </div>
                        </form>

                    </div>
                </div>
                <div class="card shadow">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Employee Details</p>
                    </div>
                    <div class="card-body">
                        {% if employee %}
                            <div class="row mb-3">
                                <div class="col">
                                    <p><strong>Date of Birth:</strong> {{ employee.DOB }}</p>
                                </div>
                                <div class="col">
                                    <p><strong>Role:</strong> {{ employee.role }}</p>
                                </div>
                                <div class="col">
                                    <p><strong>Pay Grade:</strong> {{ employee.pay_grade }}</p>
                                </div>
                            </div>

                            <form method="post" novalidate>
                                {% csrf_token %}
                                <input type="hidden" name="form_type" value="employee_edit_form">

                                {% if employee_form.non_field_errors %}
                                    <div class="alert alert-danger">
                                        {% for error in employee_form.non_field_errors %}
                                            <div>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                <div class="mb-3">
                                    <label class="form-label" for="id_Address"><strong>Address</strong></label>
                                    <textarea id="id_Address" class="form-control {% if employee_form.Address.errors %}is-invalid{% endif %}" 
                                            name="Address" rows="3">{{ employee_form.Address.value|default:employee.Address|default:"" }}</textarea>
                                    {% for error in employee_form.Address.errors %}
                                        <div class="invalid-feedback">{{ error }}</div>
                                    {% endfor %}
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <div class="mb-3">
                                            <label class="form-label" for="id_mobile_number"><strong>Mobile Number</strong></label>
                                            <input id="id_mobile_number" class="form-control {% if employee_form.mobile_number.errors %}is-invalid{% endif %}" 
                                                type="text" name="mobile_number" 
                                                value="{{ employee_form.mobile_number.value|default:employee.mobile_number|default:"" }}">
                                            {% for error in employee_form.mobile_number.errors %}
                                                <div class="invalid-feedback">{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                    </div>

                                    <div class="col">
                                        <div class="mb-3">
                                            <label class="form-label" for="id_shift"><strong>Shift</strong></label>
                                            <select id="id_shift" name="shift" class="form-select {% if employee_form.shift.errors %}is-invalid{% endif %}">
                                                {% for value, text in employee_form.shift.field.choices %}
                                                    <option value="{{ value }}" {% if employee_form.shift.value|default:employee.shift == value %}selected{% endif %}>
                                                        {{ text }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                            {% for error in employee_form.shift.errors %}
                                                <div class="invalid-feedback">{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <button class="btn btn-primary btn-sm" type="submit">Save Employee Settings</button>
                                </div>
                            </form>

                        {% else %}
                            <div class="alert alert-info">
                                No employee profile is linked to this user account.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}